<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© | Memory Match</title>
  <!-- Arabic Modern Font -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg-start:#0f172a;        /* slate-900 */
      --bg-end:#1e293b;          /* slate-800 */
      --primary:#22c55e;         /* green-500 */
      --primary-2:#10b981;       /* emerald-500 */
      --accent:#60a5fa;          /* blue-400 */
      --accent-2:#a78bfa;        /* violet-400 */
      --danger:#ef4444;          /* red-500 */
      --text:#e5e7eb;            /* gray-200 */
      --muted:#94a3b8;           /* slate-400 */
      --glass:rgba(255,255,255,0.08);
      --glass-strong:rgba(255,255,255,0.16);
      --shadow:0 10px 25px rgba(0,0,0,0.35);
      --radius:18px;
      --radius-sm:12px;
    }

    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      background: radial-gradient(1200px circle at 10% 10%, #0ea5e9 0%, transparent 40%),
                  radial-gradient(900px circle at 90% 20%, #a855f7 0%, transparent 40%),
                  linear-gradient(180deg, var(--bg-start), var(--bg-end));
      font-family: "Cairo", system-ui, -apple-system, "Segoe UI", "Tahoma", sans-serif;
      color: var(--text);
    }

    .app {
      min-height: 100vh;
      display: grid;
      grid-template-rows: auto 1fr;
      padding-bottom: 70px; /* room for fixed footer */
    }

    /* Top Bar */
    .topbar {
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(0,0,0,0.2), rgba(0,0,0,0.12));
      border-bottom: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 8px 20px rgba(0,0,0,0.25);
    }
    .topbar-inner {
      max-width: 1100px;
      margin: 0 auto;
      padding: 14px 20px;
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 10px;
      align-items: center;
    }
    .players {
      display: flex; gap: 10px; align-items: center; flex-wrap: wrap;
    }
    .player-chip {
      display: flex; align-items: center; gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: var(--glass);
      border: 1px solid rgba(255,255,255,0.1);
    }
    .player-chip.active {
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      color: #0b1020;
      font-weight: 700;
      box-shadow: 0 8px 18px rgba(96,165,250,0.35);
    }
    .player-name { white-space: nowrap; }
    .player-score {
      padding: 2px 8px; border-radius: 999px; background: rgba(0,0,0,0.25); font-weight: 700;
    }

    .stats {
      display: flex; gap: 10px; align-items: center; justify-content: center; flex-wrap: wrap;
    }
    .stat {
      padding: 8px 12px; border-radius: 999px; background: var(--glass);
      border: 1px solid rgba(255,255,255,0.1);
    }
    .controls {
      display: flex; gap: 8px; align-items: center; justify-content: end; flex-wrap: wrap;
    }
    .btn {
      border: none; cursor: pointer; padding: 10px 14px;
      border-radius: 999px; font-weight: 700;
      color: #0b1020;
      background: linear-gradient(90deg, var(--primary), var(--primary-2));
      box-shadow: 0 10px 18px rgba(16,185,129,0.35);
      transition: transform .15s ease, filter .15s ease;
    }
    .btn.secondary {
      color: var(--text);
      background: var(--glass);
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: none;
    }
    .btn:hover { transform: translateY(-1px); filter: brightness(1.06); }
    .btn:active { transform: translateY(0); filter: brightness(0.98); }

    /* Start Screen */
    .screen {
      max-width: 1100px;
      margin: 24px auto;
      padding: 20px;
    }
    .card-panel {
      background: var(--glass);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
    }
    .start-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    .start-title {
      font-size: 1.8rem; font-weight: 700; margin-bottom: 6px;
    }
    .sub { color: var(--muted); margin-bottom: 16px; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
    .radio {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 8px 10px; border-radius: 999px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      cursor: pointer;
    }
    .inputs {
      display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 12px;
    }
    .input {
      display: flex; flex-direction: column; gap: 6px;
    }
    label { color: var(--muted); font-size: .95rem; }
    input[type="text"] {
      width: 100%; padding: 12px 14px; border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06); color: var(--text);
      outline: none;
    }
    input[type="text"]::placeholder { color: #b8c1d9; }
    .actions { display: flex; gap: 10px; margin-top: 14px; }

    /* Game Board */
    .game-wrap {
      display: grid; grid-template-columns: 280px 1fr; gap: 16px;
    }
    .sidebar {
      background: var(--glass);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
      height: fit-content;
    }
    .sidebar h3 { margin: 6px 0 12px; }
    .legend { color: var(--muted); font-size: .95rem; }
    .board {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
      gap: 12px;
      background: var(--glass);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
      align-content: start;
    }
    .card {
      width: 100%; aspect-ratio: 1/1;
      perspective: 900px;
    }
    .card-inner {
      position: relative; width: 100%; height: 100%; border-radius: var(--radius-sm);
      transform-style: preserve-3d;
      transition: transform .35s cubic-bezier(.2,.8,.2,1), filter .15s ease;
      box-shadow: 0 8px 14px rgba(0,0,0,0.35);
      background: linear-gradient(180deg, rgba(255,255,255,0.1), rgba(255,255,255,0.06));
      border: 1px solid rgba(255,255,255,0.12);
    }
    .card-inner:hover { filter: brightness(1.1); }
    .card.flipped .card-inner { transform: rotateY(180deg); }
    .face {
      position: absolute; inset: 0;
      display: grid; place-items: center;
      backface-visibility: hidden;
      border-radius: var(--radius-sm);
      font-size: 2.2rem;
    }
    .front {
      transform: rotateY(180deg);
      background: radial-gradient(120px circle at 50% 40%, rgba(255,255,255,0.25), rgba(255,255,255,0.06));
    }
    .back {
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      color: #0b1020;
      font-weight: 700;
    }
    .card.matched .card-inner {
      animation: pop .35s ease;
      box-shadow: 0 12px 22px rgba(34,197,94,0.45);
      border-color: rgba(34,197,94,0.6);
    }
    @keyframes pop {
      0% { transform: scale(1) rotateY(180deg); }
      50% { transform: scale(1.07) rotateY(180deg); }
      100% { transform: scale(1) rotateY(180deg); }
    }

    .hidden { display: none !important; }

    /* Modal */
    .modal {
      position: fixed; inset: 0; display: grid; place-items: center;
      background: rgba(0,0,0,0.5); backdrop-filter: blur(4px);
      z-index: 50;
    }
    .modal-card {
      width: min(620px, 92vw);
      background: var(--glass);
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
    }
    .modal-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 6px; }
    .modal-body { color: var(--text); }
    .modal-actions { display:flex; gap:10px; margin-top:12px; justify-content:flex-end; }

    /* Fixed Footer */
    .footer {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.35));
      border-top: 1px solid rgba(255,255,255,0.12);
      backdrop-filter: blur(8px);
      box-shadow: 0 -8px 18px rgba(0,0,0,0.25);
      z-index: 30;
    }
    .footer-inner {
      max-width: 1100px;
      margin: 0 auto;
      display: grid; grid-template-columns: 1fr 1fr 1fr;
      gap: 8px;
      padding: 10px 16px;
      align-items: center;
      font-size: .95rem;
    }
    .footer-item { color: var(--text); }
    .footer-item b { color: #fff; }

    /* Responsive */
    @media (max-width: 900px) {
      .game-wrap { grid-template-columns: 1fr; }
      .topbar-inner { grid-template-columns: 1fr; gap: 8px; }
      .footer-inner { grid-template-columns: 1fr; text-align: center; }
    }
    @media (max-width: 550px) {
      .start-grid { grid-template-columns: 1fr; }
      .inputs { grid-template-columns: 1fr; }
      .board { gap: 10px; padding: 12px; }
      .face { font-size: 1.9rem; }
    }
  </style>
</head>
<body>

  <div class="app">

    <!-- Top bar -->
    <header class="topbar">
      <div class="topbar-inner">
        <div class="players" id="playersBar">
          <!-- Dynamically filled -->
        </div>
        <div class="stats">
          <div class="stat">â±ï¸ Ø§Ù„ÙˆÙ‚Øª: <b id="time">00:00</b></div>
          <div class="stat">ğŸ¯ Ø§Ù„Ø­Ø±ÙƒØ§Øª: <b id="moves">0</b></div>
          <div class="stat">ğŸ§© Ø§Ù„Ø£Ø²ÙˆØ§Ø¬ Ø§Ù„Ù…ÙƒØªØ´ÙØ©: <b id="pairs">0</b></div>
        </div>
        <div class="controls">
          <button class="btn secondary" id="newGameBtn">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
          <button class="btn" id="restartBtn">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ±ØªÙŠØ¨</button>
        </div>
      </div>
    </header>

    <!-- Screens -->
    <main class="screen">

      <!-- Start Screen -->
      <section id="start-screen" class="card-panel">
        <div class="start-grid">
          <div>
            <div class="start-title">Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© ğŸ§ âœ¨</div>
            <div class="sub">Ø§Ø®ØªØ± Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙˆØ£Ø¯Ø®Ù„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø«Ù… Ø§Ø¶ØºØ· "Ø§Ø¨Ø¯Ø£".</div>

            <div class="row" role="group" aria-label="Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†">
              <label class="radio">
                <input type="radio" name="mode" value="1" checked> Ù„Ø§Ø¹Ø¨ ÙˆØ§Ø­Ø¯
              </label>
              <label class="radio">
                <input type="radio" name="mode" value="2"> Ù„Ø§Ø¹Ø¨Ø§Ù†
              </label>
            </div>

            <div class="inputs">
              <div class="input">
                <label for="p1">Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø£ÙˆÙ„</label>
                <input id="p1" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø³Ø¹ÙŠØ¯" />
              </div>
              <div class="input" id="p2Wrap">
                <label for="p2">Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ</label>
                <input id="p2" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯" />
              </div>
            </div>

            <div class="actions">
              <button class="btn" id="startBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
            </div>
          </div>

          <div class="sidebar">
            <h3>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù„Ø¹Ø¨</h3>
            <p class="legend">
              Ø§Ù‚Ù„Ø¨ Ø¨Ø·Ø§Ù‚ØªÙŠÙ† ÙÙŠ ÙƒÙ„ Ø¯ÙˆØ±. Ø¥Ø°Ø§ ØªØ·Ø§Ø¨Ù‚Øª Ø§Ù„Ø±Ù…ÙˆØ² ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ù†Ù‚Ø·Ø© ÙˆØªÙƒÙ…Ù„ Ø§Ù„Ø¯ÙˆØ±Ø›
              ÙˆØ¥Ø°Ø§ Ù„Ù… ØªØªØ·Ø§Ø¨Ù‚ ØªÙ†ØªÙ‚Ù„ ÙØ±ØµØ© Ø§Ù„Ù„Ø¹Ø¨ Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø¢Ø®Ø±. ÙÙŠ Ù†Ù…Ø· Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„ÙˆØ§Ø­Ø¯ØŒ
              Ø­Ø§ÙˆÙ„ Ø¥Ù†Ù‡Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²ÙˆØ§Ø¬ Ø¨Ø£Ù‚Ù„ ÙˆÙ‚Øª ÙˆØ¹Ø¯Ø¯ Ø­Ø±ÙƒØ§Øª Ù…Ù…ÙƒÙ†.
            </p>
            <h3>Ù†ØµØ§Ø¦Ø­</h3>
            <ul class="legend">
              <li>Ø±ÙƒÙ‘Ø² Ø¹Ù„Ù‰ Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ÙˆØªØ°ÙƒÙ‘Ø± Ø§Ù„Ø±Ù…ÙˆØ².</li>
              <li>Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± <b>Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ±ØªÙŠØ¨</b> Ù„Ø¨Ø¯Ø¡ Ù†ÙØ³ Ø§Ù„Ø¬ÙˆÙ„Ø© Ù…Ø¹ Ø®Ù„Ø· Ø¬Ø¯ÙŠØ¯.</li>
              <li>Ø²Ø± <b>Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</b> ÙŠØ¹ÙŠØ¯Ùƒ Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø¡ Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø£Ùˆ Ø§Ù„Ø¹Ø¯Ø¯.</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Game Screen -->
      <section id="game-screen" class="hidden">
        <div class="game-wrap">
          <aside class="sidebar">
            <h3>Ø­Ø§Ù„Ø© Ø§Ù„Ø¬ÙˆÙ„Ø©</h3>
            <p class="legend" id="turnInfo">Ø§Ù„Ø¯ÙˆØ±: â€”</p>
            <hr style="border-color: rgba(255,255,255,0.12);">
            <h3>Ø§Ù„Ø£Ù‡Ø¯Ø§Ù</h3>
            <p class="legend">Ø§ÙƒØªØ´Ù ÙƒÙ„ Ø§Ù„Ø£Ø²ÙˆØ§Ø¬ Ù„Ù„ÙÙˆØ² Ø¨Ø§Ù„Ø¬ÙˆÙ„Ø©! ğŸ‰</p>
          </aside>

          <div class="board" id="board">
            <!-- Cards injected here -->
          </div>
        </div>
      </section>

    </main>

    <!-- Fixed Footer -->
    <footer class="footer">
      <div class="footer-inner">
        <div class="footer-item">
          <b>Student Name:</b> SAEED MOHAMMED BIN SAEED ALZAHRANI
          <span style="opacity:.9;">(Ø³Ø¹ÙŠØ¯ Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ)</span>
        </div>
        <div class="footer-item">
          <b>Student ID:</b> 44610519
        </div>
        <div class="footer-item">
          <b>Supervised by:</b> Mohammed Ahmed Jabali
        </div>
      </div>
    </footer>

    <!-- Modal -->
    <div id="modal" class="modal hidden" aria-hidden="true">
      <div class="modal-card">
        <div class="modal-title" id="modalTitle">Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬ÙˆÙ„Ø© ğŸ‰</div>
        <div class="modal-body" id="modalBody"></div>
        <div class="modal-actions">
          <button class="btn secondary" id="modalClose">Ø¥ØºÙ„Ø§Ù‚</button>
          <button class="btn" id="modalPlayAgain">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨</button>
        </div>
      </div>
    </div>

  </div>

  <script>
    // =========================
    // Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© - Memory Match
    // =========================

    const boardEl = document.getElementById('board');
    const startScreen = document.getElementById('start-screen');
    const gameScreen = document.getElementById('game-screen');

    const playersBar = document.getElementById('playersBar');
    const movesEl = document.getElementById('moves');
    const timeEl = document.getElementById('time');
    const pairsEl = document.getElementById('pairs');
    const turnInfo = document.getElementById('turnInfo');

    const restartBtn = document.getElementById('restartBtn');
    const newGameBtn = document.getElementById('newGameBtn');

    const startBtn = document.getElementById('startBtn');
    const p1Input = document.getElementById('p1');
    const p2Input = document.getElementById('p2');
    const p2Wrap = document.getElementById('p2Wrap');

    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');
    const modalClose = document.getElementById('modalClose');
    const modalPlayAgain = document.getElementById('modalPlayAgain');

    // Game state
    const state = {
      mode: 1,                 // 1 or 2 players
      players: [{ name: 'Ù„Ø§Ø¹Ø¨ Ù¡', score: 0 }, { name: 'Ù„Ø§Ø¹Ø¨ Ù¢', score: 0 }],
      current: 0,              // index of current player
      deck: [],                // array of card objects
      first: null,             // first flipped card reference
      lock: false,             // lock board during animations
      moves: 0,                // move count (pairs attempted)
      pairsFound: 0,           // matched pairs
      totalPairs: 8,           // default pairs count
      started: false,          // timer started?
      seconds: 0,
      timerId: null,
    };

    // Emoji set (we choose 8 random each game)
    const EMOJIS = [
      'ğŸ±','ğŸ¶','ğŸ¼','ğŸ¦Š','ğŸ¦','ğŸ¸','ğŸµ','ğŸ·',
      'ğŸ','ğŸŒ','ğŸ‡','ğŸ’','ğŸ‰','ğŸ¥','ğŸ¥‘','ğŸŒ½',
      'âš½ï¸','ğŸ€','ğŸ¾','ğŸ“','ğŸ²','ğŸ§©','ğŸ¯','ğŸ®',
      'ğŸš—','âœˆï¸','ğŸš€','ğŸ›°ï¸','ğŸš²','ğŸ›´','ğŸ›µ','ğŸšœ'
    ];

    // Utility: format time
    function formatTime(s){
      const m = Math.floor(s/60).toString().padStart(2,'0');
      const sec = (s%60).toString().padStart(2,'0');
      return `${m}:${sec}`;
    }

    function startTimer(){
      if (state.started) return;
      state.started = true;
      state.timerId = setInterval(()=>{
        state.seconds++;
        timeEl.textContent = formatTime(state.seconds);
      }, 1000);
    }
    function stopTimer(){
      clearInterval(state.timerId);
      state.timerId = null;
      state.started = false;
    }
    function resetTimer(){
      stopTimer();
      state.seconds = 0;
      timeEl.textContent = '00:00';
    }

    // Shuffle array in-place
    function shuffle(a){
      for (let i = a.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    // Pick N random unique emojis
    function pickEmojis(n){
      const pool = [...EMOJIS];
      shuffle(pool);
      return pool.slice(0, n);
    }

    function updateTopBar(){
      playersBar.innerHTML = '';
      const wrap = document.createDocumentFragment();

      // Player 1
      const p1 = document.createElement('div');
      p1.className = 'player-chip' + (state.current===0 ? ' active':'');
      p1.innerHTML = `<span class="player-name">ğŸ‘¤ ${state.players[0].name}</span>
                      <span class="player-score">Ù†Ù‚Ø§Ø·: ${state.players[0].score}</span>`;
      wrap.appendChild(p1);

      if (state.mode === 2){
        const dash = document.createElement('div');
        dash.style.opacity = '.7';
        dash.textContent = 'â€”';
        dash.setAttribute('aria-hidden','true');
        wrap.appendChild(dash);

        const p2 = document.createElement('div');
        p2.className = 'player-chip' + (state.current===1 ? ' active':'');
        p2.innerHTML = `<span class="player-name">ğŸ‘¤ ${state.players[1].name}</span>
                        <span class="player-score">Ù†Ù‚Ø§Ø·: ${state.players[1].score}</span>`;
        wrap.appendChild(p2);
      }

      playersBar.appendChild(wrap);

      movesEl.textContent = state.moves;
      pairsEl.textContent = state.pairsFound;
      turnInfo.textContent = (state.mode===2)
        ? `Ø§Ù„Ø¯ÙˆØ±: ${state.players[state.current].name}`
        : `Ø§Ù„Ù†Ù…Ø·: Ù„Ø§Ø¹Ø¨ ÙˆØ§Ø­Ø¯ â€” Ø§Ø³ØªÙƒØ´Ù ÙƒÙ„ Ø§Ù„Ø£Ø²ÙˆØ§Ø¬!`;
    }

    function buildDeck(){
      const selected = pickEmojis(state.totalPairs);
      const deck = [];
      let cid = 0;
      selected.forEach(sym=>{
        deck.push({ id: cid++, symbol: sym, matched:false });
        deck.push({ id: cid++, symbol: sym, matched:false });
      });
      shuffle(deck);
      state.deck = deck;
    }

    function renderBoard(){
      boardEl.innerHTML = '';
      const frag = document.createDocumentFragment();
      state.deck.forEach((card, index)=>{
        const cell = document.createElement('div');
        cell.className = 'card';
        cell.dataset.index = index;

        const inner = document.createElement('div');
        inner.className = 'card-inner';

        const back = document.createElement('div');
        back.className = 'face back';
        back.textContent = 'Ø§Ù‚Ù„Ø¨Ù†ÙŠ';

        const front = document.createElement('div');
        front.className = 'face front';
        front.textContent = card.symbol;

        inner.appendChild(back);
        inner.appendChild(front);
        cell.appendChild(inner);

        cell.addEventListener('click', onCardClick);
        frag.appendChild(cell);
      });
      boardEl.appendChild(frag);
    }

    function onCardClick(e){
      const container = e.currentTarget;
      const index = Number(container.dataset.index);
      const card = state.deck[index];

      if (state.lock) return;
      if (card.matched) return;

      // Start timer on first action
      startTimer();

      // Avoid clicking the same one twice
      if (state.first && state.first.index === index) return;

      // Flip visual
      container.classList.add('flipped');

      if (!state.first){
        state.first = { index, el: container, card };
        return;
      }

      // Second flip -> one move
      state.moves++;
      movesEl.textContent = state.moves;

      const match = (card.symbol === state.first.card.symbol);
      if (match){
        // Mark matched
        card.matched = true;
        state.deck[state.first.index].matched = true;

        container.classList.add('matched');
        state.first.el.classList.add('matched');

        state.pairsFound++;
        pairsEl.textContent = state.pairsFound;

        // Add score to current player (or single player)
        state.players[state.current].score++;
        updateTopBar();

        // Clear selection
        state.first = null;

        // Check win
        if (state.pairsFound === state.totalPairs){
          stopTimer();
          showResults();
        }
      } else {
        // Lock and unflip both after short delay, then switch player if mode=2
        state.lock = true;
        setTimeout(()=>{
          container.classList.remove('flipped');
          state.first.el.classList.remove('flipped');
          state.first = null;
          state.lock = false;

          if (state.mode === 2){
            state.current = (state.current === 0 ? 1 : 0);
            updateTopBar();
          }
        }, 700);
      }
    }

    function showResults(){
      const pA = state.players[0];
      const pB = state.players[1];
      let title = 'Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬ÙˆÙ„Ø© ğŸ‰';
      let body = '';

      if (state.mode === 1){
        title = 'Ø£Ø­Ø³Ù†Øª! Ø£Ù†Ù‡ÙŠØª Ø§Ù„Ø¬ÙˆÙ„Ø© ğŸ‘';
        body = `
          <p>Ø§Ù„Ù„Ø§Ø¹Ø¨: <b>${pA.name}</b></p>
          <p>Ø§Ù„ÙˆÙ‚Øª: <b>${formatTime(state.seconds)}</b></p>
          <p>Ø§Ù„Ø­Ø±ÙƒØ§Øª: <b>${state.moves}</b></p>
          <p>Ø§Ù„Ø£Ø²ÙˆØ§Ø¬ Ø§Ù„Ù…ÙƒØªØ´ÙØ©: <b>${state.pairsFound}/${state.totalPairs}</b></p>
        `;
      } else {
        const winner =
          pA.score === pB.score ? 'ØªØ¹Ø§Ø¯Ù„ ğŸ¤' :
          (pA.score > pB.score ? `Ø§Ù„ÙØ§Ø¦Ø²: <b>${pA.name}</b> ğŸ†` : `Ø§Ù„ÙØ§Ø¦Ø²: <b>${pB.name}</b> ğŸ†`);
        body = `
          <p>${winner}</p>
          <p>${pA.name}: <b>${pA.score}</b> Ù†Ù‚Ø·Ø©</p>
          <p>${pB.name}: <b>${pB.score}</b> Ù†Ù‚Ø·Ø©</p>
          <p>Ø§Ù„ÙˆÙ‚Øª: <b>${formatTime(state.seconds)}</b> â€” Ø§Ù„Ø­Ø±ÙƒØ§Øª: <b>${state.moves}</b></p>
        `;
      }

      modalTitle.textContent = title;
      modalBody.innerHTML = body;
      modal.classList.remove('hidden');
      modal.setAttribute('aria-hidden','false');
    }

    function hideModal(){
      modal.classList.add('hidden');
      modal.setAttribute('aria-hidden','true');
    }

    function resetScoresAndCounters(){
      state.players[0].score = 0;
      state.players[1].score = 0;
      state.moves = 0;
      state.pairsFound = 0;
      state.current = 0;
      resetTimer();
      updateTopBar();
    }

    function startRound(){
      // Adjust pairs for screen size (optional smart scaling)
      const width = window.innerWidth;
      state.totalPairs = width < 480 ? 6 : width < 768 ? 8 : 10; // 12â€“20 cards
      resetScoresAndCounters();
      buildDeck();
      renderBoard();
      gameScreen.classList.remove('hidden');
      startScreen.classList.add('hidden');
    }

    function restartRound(){
      // Keep same players & mode, re-shuffle
      resetScoresAndCounters();
      buildDeck();
      renderBoard();
      hideModal();
    }

    function goToStart(){
      hideModal();
      stopTimer();
      startScreen.classList.remove('hidden');
      gameScreen.classList.add('hidden');
    }

    // Event bindings
    document.querySelectorAll('input[name="mode"]').forEach(r=>{
      r.addEventListener('change',(e)=>{
        state.mode = Number(e.target.value);
        p2Wrap.style.display = state.mode === 2 ? 'flex' : 'none';
      });
    });

    startBtn.addEventListener('click', ()=>{
      const name1 = (p1Input.value || '').trim();
      const name2 = (p2Input.value || '').trim();

      state.players[0].name = name1 || 'Ù„Ø§Ø¹Ø¨ Ù¡';
      state.players[1].name = name2 || 'Ù„Ø§Ø¹Ø¨ Ù¢';

      // Validate
      if (state.mode === 2 && !state.players[1].name){
        alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ.');
        return;
      }
      startRound();
    });

    restartBtn.addEventListener('click', restartRound);
    newGameBtn.addEventListener('click', goToStart);

    modalClose.addEventListener('click', hideModal);
    modalPlayAgain.addEventListener('click', ()=>{ hideModal(); restartRound(); });

    // Initialize UI
    (function init(){
      p2Wrap.style.display = 'none';
      updateTopBar();
    })();

    // Accessibility: close modal on ESC
    document.addEventListener('keydown', (e)=>{
      if (e.key === 'Escape' && !modal.classList.contains('hidden')) hideModal();
    });

    // Handle resize -> optionally keep pairs count reasonable on mobile
    window.addEventListener('resize', ()=>{
      // no auto change during round to avoid confusion
    });
  </script>
</body>
</html>